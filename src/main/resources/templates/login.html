<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default">
<head>
	<meta charset="UTF-8">
	<title>Login</title>
	<style>
		.login-form {
			width: 385px;
			margin: 30px auto;
		}
		.login-form form {
			margin-bottom: 15px;
			background: #f7f7f7;
			box-shadow: 0px 2px 2px 2px rgba(0, 0, 0, 0.3);
			padding: 30px;
		}
		.login-form h2 {
			margin: 0 0 15px;
		}
		.form-control, .login-btn {
			min-height: 38px;
			border-radius: 2px;
		}
		.input-group-addon .fa {
			font-size: 18px;
		}
		.login-btn {
			font-size: 15px;
			font-weight: bold;
		}
		.social-btn .btn {
			border: none;
			margin: 10px 3px 0;
			opacity: 1;
		}
		.social-btn .btn:hover {
			opacity: 0.9;
		}
		.social-btn .btn-primary {
			background: #507cc0;
		}
		.social-btn .btn-info {
			background: #64ccf1;
		}
		.social-btn .btn-danger {
			background: #df4930;
		}
		.or-seperator {
			margin-top: 20px;
			text-align: center;
			border-top: 1px solid #ccc;
		}
		.or-seperator i {
			padding: 0 10px;
			background: #f7f7f7;
			position: relative;
			top: -11px;
			z-index: 1;
		}
	</style>
</head>
<body>
	<main layout:fragment="container">
		<div class="login-form">
			<form th:action="@{/login}" th:method="post">
				<h4 class="text-center">배치 시스템 로그인</h4>
				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<span class="input-group-text"><i class="far fa-user"></i></span>
					</div>
					<input type="text" class="form-control" name="username" placeholder="ID" required="required" tabindex="1"/>
				</div>
				<div class="input-group mb-3">
					<div class="input-group-prepend">
						<span class="input-group-text"><i class="fas fa-lock"></i></span>
					</div>
					<input type="password" class="form-control" name="password" placeholder="Password" required="required" tabindex="2"/>
				</div>
				<div class="input-group mb-3">
					<button type="submit" class="btn btn-primary login-btn btn-block" tabindex="3">
						<i class="fas fa-sign-in-alt"> 접속</i>
					</button>
				</div><!--
				<div class="clearfix">
					<label class="pull-left checkbox-inline"><input type="checkbox"> Remember me</label>
					<a href="#" class="pull-right">Forgot Password?</a>
				</div> -->
			</form>
			<p class="text-center text-muted small"><a href="javascript:openRegister()" tabindex="4">사용자 등록</a></p>
		</div>
		<div class="modal fade" id="registerAdmin" tabindex="-1" role="dialog" aria-labelledby="registerAdminLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<form id="admin" th:action="@{/loginForm}" th:method="post">
						<div class="modal-header">
							<h5 class="modal-title" id="registerAdminLabel">사용자 등록</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="username" class="col-form-label">ID</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="far fa-user"></i></span>
										</div>
										<input type="text" class="form-control" id="username" name="username" required="required" tabindex="5"/>
									</div>
								</div>
								<div class="col-md-6 mb-3">
									<label for="name" class="col-form-label">성명</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="far fa-smile"></i></span>
										</div>
										<input type="text" class="form-control" id="name" name="name" required="required" tabindex="6"/>
									</div>
								</div>
								<div class="col-md-8 mb-3">
									<label for="password" class="col-form-label">패스워드</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="fas fa-lock"></i></span>
										</div>
										<input type="password" class="form-control" id="password" name="password" required="required" tabindex="7"/>
									</div>
								</div>
								<div class="col-md-8 mb-3">
									<label for="confirmPassword" class="col-form-label">패스워드 확인</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="fas fa-unlock"></i></span>
										</div>
										<input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required="required" tabindex="8"/>
									</div>
								</div>
								<div class="col-md-6 mb-3">
									<label for="dept" class="col-form-label">소속</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
										</div>
										<input type="text" class="form-control" id="dept" name="dept" required="required" tabindex="9"/>
									</div>
								</div>
								<div class="col-md-6 mb-3">
									<label for="email" class="col-form-label">E-Mail</label>
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="fas fa-at"></i></span>
										</div>
										<input type="email" class="form-control" id="email" name="email" required="required" tabindex="10"/>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">
								<i class="far fa-window-close"> 닫기</i>
							</button>
							<button type="submit" class="btn btn-sm btn-primary">
								<i class="fas fa-user-plus"> 등록요청</i>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</main>
	<script layout:fragment="script" th:inline="javascript">
		/*<![CDATA[*/
		const errorMsg = /*[[${errorMsg}]]*/ null
		if (errorMsg != null) {
			alert(errorMsg)
			location.href = '/loginForm'
		}
		const openRegister = function() {
			$('#registerAdmin').modal('show')
		}
		const registerSuccessHandler = function(data) {
			alert(data['message'])
			if (data['success']) location.href = '/loginForm'
		}
		const registerFailHandler = function(response) {
			let errors = response['responseJSON']['errors']
			let msg = errors.reduce(function(prev, curr) {
				return prev + curr['defaultMessage'] + '\n'
			}, '')
			alert(msg)
		}
		$('input[name=username]').focus()
		$('#registerAdmin').on('shown.bs.modal', e => {
			$('.modal-body input#username').focus()
		})
		$('#registerAdmin').on('hidden.bs.modal', e => {
			$('.modal-body input').val('')
		})
		$('form#admin').on('submit', function(e) {
			e.preventDefault()
			let params = $(this).serializeObject()
			$.post('/loginForm', params, registerSuccessHandler, 'json')
				.done(function(data) {
					console.log('second')
				})
				.fail(registerFailHandler)
		})
		/*]]>*/
	</script>
</body>
</html>